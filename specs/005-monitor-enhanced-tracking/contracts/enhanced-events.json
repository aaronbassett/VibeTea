{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://vibetea.dev/schemas/enhanced-events.json",
  "title": "VibeTea Enhanced Event Schemas",
  "description": "JSON schemas for new event types in monitor enhanced tracking feature",
  "definitions": {
    "AgentSpawnEvent": {
      "type": "object",
      "description": "Event emitted when Task tool spawns a specialized agent",
      "required": ["type", "session_id", "agent_type", "description", "timestamp"],
      "properties": {
        "type": {
          "const": "agent_spawn"
        },
        "session_id": {
          "type": "string",
          "format": "uuid",
          "description": "UUID of the parent session"
        },
        "agent_type": {
          "type": "string",
          "description": "Agent type identifier (e.g., 'devs:rust-dev', 'Explore')",
          "examples": ["devs:rust-dev", "devs:typescript-dev", "Explore", "Plan"]
        },
        "description": {
          "type": "string",
          "description": "Short description of the agent task",
          "maxLength": 200
        },
        "timestamp": {
          "type": "string",
          "format": "date-time",
          "description": "ISO 8601 timestamp of agent spawn"
        }
      },
      "additionalProperties": false
    },
    "SkillInvocationEvent": {
      "type": "object",
      "description": "Event emitted when a skill/command is invoked",
      "required": ["type", "session_id", "skill_name", "project", "timestamp"],
      "properties": {
        "type": {
          "const": "skill_invocation"
        },
        "session_id": {
          "type": "string",
          "format": "uuid",
          "description": "UUID of the invoking session"
        },
        "skill_name": {
          "type": "string",
          "description": "Name of the invoked skill (starts with /)",
          "pattern": "^/[a-zA-Z0-9:_-]+$",
          "examples": ["/commit", "/sdd:plan", "/worktrees:status"]
        },
        "project": {
          "type": "string",
          "description": "Absolute path to project root"
        },
        "timestamp": {
          "type": "string",
          "format": "date-time",
          "description": "ISO 8601 timestamp of invocation"
        }
      },
      "additionalProperties": false
    },
    "TokenUsageEvent": {
      "type": "object",
      "description": "Event containing per-model token usage statistics",
      "required": ["type", "model", "input_tokens", "output_tokens", "cache_read_tokens", "cache_creation_tokens"],
      "properties": {
        "type": {
          "const": "token_usage"
        },
        "model": {
          "type": "string",
          "description": "Model identifier with version",
          "examples": ["claude-opus-4-5-20251101", "claude-sonnet-4-20250514"]
        },
        "input_tokens": {
          "type": "integer",
          "minimum": 0,
          "description": "Total input tokens consumed"
        },
        "output_tokens": {
          "type": "integer",
          "minimum": 0,
          "description": "Total output tokens generated"
        },
        "cache_read_tokens": {
          "type": "integer",
          "minimum": 0,
          "description": "Tokens read from cache"
        },
        "cache_creation_tokens": {
          "type": "integer",
          "minimum": 0,
          "description": "Tokens used to create cache entries"
        }
      },
      "additionalProperties": false
    },
    "SessionMetricsEvent": {
      "type": "object",
      "description": "Event containing global session metrics",
      "required": ["type", "total_sessions", "total_messages", "total_tool_usage", "longest_session"],
      "properties": {
        "type": {
          "const": "session_metrics"
        },
        "total_sessions": {
          "type": "integer",
          "minimum": 0,
          "description": "Total number of sessions"
        },
        "total_messages": {
          "type": "integer",
          "minimum": 0,
          "description": "Total number of messages across all sessions"
        },
        "total_tool_usage": {
          "type": "integer",
          "minimum": 0,
          "description": "Total number of tool invocations"
        },
        "longest_session": {
          "type": "string",
          "pattern": "^[0-9]{2}:[0-9]{2}:[0-9]{2}$",
          "description": "Duration of longest session (HH:MM:SS)"
        }
      },
      "additionalProperties": false
    },
    "ActivityPatternEvent": {
      "type": "object",
      "description": "Event containing hourly activity distribution",
      "required": ["type", "hour_counts"],
      "properties": {
        "type": {
          "const": "activity_pattern"
        },
        "hour_counts": {
          "type": "object",
          "description": "Message count per hour (keys: 0-23)",
          "propertyNames": {
            "pattern": "^([0-9]|1[0-9]|2[0-3])$"
          },
          "additionalProperties": {
            "type": "integer",
            "minimum": 0
          }
        }
      },
      "additionalProperties": false
    },
    "TokenUsageSummary": {
      "type": "object",
      "description": "Token usage breakdown for a single model",
      "required": ["input_tokens", "output_tokens", "cache_read_tokens", "cache_creation_tokens"],
      "properties": {
        "input_tokens": {
          "type": "integer",
          "minimum": 0
        },
        "output_tokens": {
          "type": "integer",
          "minimum": 0
        },
        "cache_read_tokens": {
          "type": "integer",
          "minimum": 0
        },
        "cache_creation_tokens": {
          "type": "integer",
          "minimum": 0
        }
      },
      "additionalProperties": false
    },
    "ModelDistributionEvent": {
      "type": "object",
      "description": "Event containing token usage distribution across models",
      "required": ["type", "model_usage"],
      "properties": {
        "type": {
          "const": "model_distribution"
        },
        "model_usage": {
          "type": "object",
          "description": "Per-model token usage",
          "additionalProperties": {
            "$ref": "#/definitions/TokenUsageSummary"
          }
        }
      },
      "additionalProperties": false
    },
    "TodoProgressEvent": {
      "type": "object",
      "description": "Event containing todo list progress for a session",
      "required": ["type", "session_id", "completed", "in_progress", "pending", "abandoned"],
      "properties": {
        "type": {
          "const": "todo_progress"
        },
        "session_id": {
          "type": "string",
          "format": "uuid",
          "description": "Session UUID"
        },
        "completed": {
          "type": "integer",
          "minimum": 0,
          "description": "Count of completed tasks"
        },
        "in_progress": {
          "type": "integer",
          "minimum": 0,
          "description": "Count of in-progress tasks"
        },
        "pending": {
          "type": "integer",
          "minimum": 0,
          "description": "Count of pending tasks"
        },
        "abandoned": {
          "type": "boolean",
          "description": "True if session ended with incomplete tasks"
        }
      },
      "additionalProperties": false
    },
    "FileChangeEvent": {
      "type": "object",
      "description": "Event containing file edit statistics from version diff",
      "required": ["type", "session_id", "file_hash", "version", "lines_added", "lines_removed", "lines_modified", "timestamp"],
      "properties": {
        "type": {
          "const": "file_change"
        },
        "session_id": {
          "type": "string",
          "format": "uuid",
          "description": "Session UUID"
        },
        "file_hash": {
          "type": "string",
          "pattern": "^[a-f0-9]{16}$",
          "description": "16-character hex hash identifying the file (one-way hash of original path, not reversible)"
        },
        "version": {
          "type": "integer",
          "minimum": 2,
          "description": "Version number (>= 2, since v1 has no diff)"
        },
        "lines_added": {
          "type": "integer",
          "minimum": 0,
          "description": "Lines added in this version"
        },
        "lines_removed": {
          "type": "integer",
          "minimum": 0,
          "description": "Lines removed in this version"
        },
        "lines_modified": {
          "type": "integer",
          "minimum": 0,
          "description": "Lines modified in this version"
        },
        "timestamp": {
          "type": "string",
          "format": "date-time",
          "description": "ISO 8601 timestamp of file change detection"
        }
      },
      "additionalProperties": false
    },
    "ProjectActivityEvent": {
      "type": "object",
      "description": "Event indicating project session activity",
      "required": ["type", "project_path", "session_id", "is_active"],
      "properties": {
        "type": {
          "const": "project_activity"
        },
        "project_path": {
          "type": "string",
          "description": "Absolute path to project (decoded from slug)"
        },
        "session_id": {
          "type": "string",
          "format": "uuid",
          "description": "Session UUID"
        },
        "is_active": {
          "type": "boolean",
          "description": "True if session is ongoing (no summary event)"
        }
      },
      "additionalProperties": false
    }
  },
  "oneOf": [
    { "$ref": "#/definitions/AgentSpawnEvent" },
    { "$ref": "#/definitions/SkillInvocationEvent" },
    { "$ref": "#/definitions/TokenUsageEvent" },
    { "$ref": "#/definitions/SessionMetricsEvent" },
    { "$ref": "#/definitions/ActivityPatternEvent" },
    { "$ref": "#/definitions/ModelDistributionEvent" },
    { "$ref": "#/definitions/TodoProgressEvent" },
    { "$ref": "#/definitions/FileChangeEvent" },
    { "$ref": "#/definitions/ProjectActivityEvent" }
  ]
}
