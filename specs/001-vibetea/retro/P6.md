# Phase 6 Retrospective: Monitor Server Connection (US4)

## What Worked Well

- **ed25519-dalek** crate provides clean API for Ed25519 operations with deterministic signing
- **reqwest** with connection pooling is efficient for HTTP event transmission
- **VecDeque** for event buffering with FIFO eviction worked well for bounded buffers
- Simple CLI parsing without external libraries (clap) kept binary size minimal
- Separating Crypto and Sender into distinct modules enabled clean testing

## What Didn't Work

- Initial implementation of jitter calculation needed refinement to avoid potential integer overflow
- Signal handling required tokio::select! for cross-platform compatibility

## Workarounds & Solutions

- Used `rand::Rng::random_range()` for jitter calculation to avoid manual float conversions
- Implemented graceful shutdown with timeout using `tokio::time::timeout` wrapper
- Base64 encoding uses `base64::prelude::*` for cleaner imports

## Packages & Dependencies

- **ed25519-dalek 2.1**: Excellent for Ed25519 operations, deterministic signing built-in
- **directories 6.0**: Cross-platform standard directory paths (`~/.vibetea`)
- **gethostname 1.0**: Simple hostname retrieval for source ID defaults
- **tempfile 3.15**: Essential for testing file operations without polluting system

## Patterns & Code

- **Key storage pattern**: Private key as raw 32-byte seed (not full keypair), public key as base64
- **Exponential backoff**: `min(initial * 2^n, max)` with Â±25% jitter prevents thundering herd
- **FIFO buffer eviction**: When buffer full, `pop_front()` oldest before `push_back()` newest
- **CLI command enum**: Simple `enum Command { Init { force: bool }, Run, Help, Version }` pattern
- **Unix permission setting**: `#[cfg(unix)]` for platform-specific 0600/0644 permissions

## For Next Time

- Consider using `clap` if CLI complexity grows beyond basic commands
- May need persistent event queue for crash recovery in future versions
- Could add `--dry-run` flag to sender for testing without actual transmission
