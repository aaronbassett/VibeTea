# Phase 3 Retrospective: User Story 1 - Environment Variable Key Loading

**Feature**: Monitor GitHub Actions Deployment
**Phase**: 3 - User Story 1 (Priority: P1) ðŸŽ¯ MVP
**Started**: 2026-02-03
**Completed**: 2026-02-03

## Objective
Enable loading Ed25519 private key from `VIBETEA_PRIVATE_KEY` environment variable for GitHub Actions deployment.

## Tasks

### Tests
- [x] T025 Create env_key_test.rs integration test in monitor/tests/env_key_test.rs
- [x] T026 Commit: add env var key loading tests

### Implementation
- [x] T027 Implement load_from_env() method in monitor/src/crypto.rs
- [x] T028 Commit: implement load_from_env for VIBETEA_PRIVATE_KEY
- [x] T029 Implement load_with_fallback() method in monitor/src/crypto.rs
- [x] T030 Commit: implement load_with_fallback with precedence logic
- [x] T031 Update run command in monitor/src/main.rs to use load_with_fallback
- [x] T032 Commit: update run command to support env var keys
- [x] T033 Zero intermediate buffers after SigningKey construction
- [x] T034 Commit: add memory zeroing for key material
- [x] T035 Run tests: cargo test -p vibetea-monitor -- --test-threads=1
- [x] T036 Commit: all US1 tests passing

## Learnings

### What Worked Well
- **TDD approach**: Writing 21 integration tests first clearly defined the expected behavior
- **serial_test crate**: Used for env var tests to prevent parallel test interference
- **zeroize crate**: Clean, secure memory wiping with compiler-safe zeroing
- **KeySource enum**: Clean separation between tracking key origin vs key operations

### Challenges Encountered
- **Method naming**: Initially named `load_with_env()`, renamed to `load_with_fallback()` to match spec
- **Memory zeroing on error paths**: Needed to ensure buffers zeroed even when validation fails

### Critical Learnings for CLAUDE.md
- **zeroize crate** should be used for any intermediate buffers containing private key material
- Memory should be zeroed on **both** success and error paths for defense in depth

## Notes
- 21 integration tests cover all FR requirements
- Round-trip test verifies: generate â†’ seed_base64 â†’ load_from_env â†’ sign â†’ verify
- load_with_fallback does NOT silently fall back if env var is set but invalid
